(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"404C":function(e,t,n){"use strict";(function(e){var a=s(n("Zx67")),o=s(n("kiBT")),c=s(n("OvRC")),r=s(n("pFYg")),l=s(n("C4MV")),i=s(n("woOf"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.WapLogin=void 0;var u=i.default||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},d=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),(0,l.default)(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();t.wapLoginState=x,t.wapLoginDispatch=P;var p=n("U7vG"),f=C(p),g=n("Zfgq"),h=C(n("4GUf")),m=n("f2Hk"),v=n("4n+p"),_=n("5qLU"),w=n("nztU"),y=C(n("mtWM"));function C(e){return e&&e.__esModule?e:{default:e}}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,r.default)(t))&&"function"!=typeof t?e:t}function k(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,r.default)(t)));e.prototype=(0,c.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(o.default?(0,o.default)(e,t):e.__proto__=t)}n("cQc5");(0,m.actionAxios)("wapLoginIndex");var T=(0,m.concatPageAndType)("global"),N={uc_loginOrReg:{url:_.UCENTER+"/login/quick_login_register",method:"post"},uc_phoneExist:function(e){return{url:_.UCENTER+"/user/phone_"+e+"/exists"}},uc_sendCode:{url:_.UCENTER+"/mock/send_code",method:"post"},uc_loginByPwd:{url:_.UCENTER+"/login/phone",method:"post"},uc_geeInit:function(e){return{url:_.UCGEE+"/gee/getChallenge?addressIp="+e+"&t="+(new Date).getTime()}},uc_geeVerify:{url:_.UCGEE+"/gee/verifyLogin",method:"post"}},S=t.WapLogin=function(t){function n(e){E(this,n);var t=b(this,(n.__proto__||(0,a.default)(n)).call(this,e));return t.codeHandle=function(){t.setState({selCode:!0})},t.pwdHandle=function(){t.setState({selCode:!1})},t.state={selCode:!0,redirect_uri:t.props.redirect_uri,params:t.props},t}return k(n,p.Component),d(n,[{key:"render",value:function(){var t=this.state,n=t.selCode,a=t.redirect_uri,o=t.params;return f.default.createElement("div",{"data-page":"wap-login",style:{minHeight:e(window).height()}},f.default.createElement("div",{className:"page-logo"},f.default.createElement("img",{src:"/src/img/user/trc-logo.png"})),f.default.createElement("div",{className:"c-tc"},f.default.createElement("div",{className:"login-method",onClick:this.codeHandle},f.default.createElement("span",null,"验证码登录"),f.default.createElement("div",{className:"split-line code",style:n?{background:"#e60a30"}:{}})),f.default.createElement("div",{className:"login-method",onClick:this.pwdHandle},f.default.createElement("span",null,"密码登录"),f.default.createElement("div",{className:"split-line pwd",style:n?{}:{background:"#e60a30"}}))),n?f.default.createElement(I,{changeLogin:this.props.changeLogin,params:o}):f.default.createElement(L,{changeLogin:this.props.changeLogin,redirect_uri:a}))}}]),n}(),I=function(t){function n(t){E(this,n);var o=b(this,(n.__proto__||(0,a.default)(n)).call(this,t));return o.checkTel=function(e){return/^1[34578]\d{9}$/.test(e)?(o.setState({telCorrect:!0}),!0):(h.default.MsgTip({msg:"请输入正确的手机号码"}),!1)},o.checkCode=function(e){return!!/^\d{4}$/.test(e)||(h.default.MsgTip({msg:"验证码不正确"}),!1)},o.loadCaptchas=function(e){y.default.request(N.uc_geeInit(e)).then(function(e){if(200===e.status){var t=e.data;initGeetest({gt:t.gt,challenge:t.challenge,offline:!t.success,new_captcha:t.serverStatus,product:"bind"},o.handlerEmbed),o.setState({serverStatus:t.serverStatus})}}).catch(function(e){console.log(e),h.default.MsgTip({msg:"服务器繁忙"})})},o.handlerEmbed=function(t){var n=o;t.onError(function(){h.default.MsgTip({msg:"验证错误"})}).onSuccess(function(){var a=t.getValidate(),o=n.state.serverStatus,c=e("#tel").val().replace(/\s+/g,"");a||h.default.MsgTip({msg:"请完成验证"}),y.default.request(u({},N.uc_geeVerify,{data:{challenge:a.geetest_challenge,validate:a.geetest_validate,seccode:a.geetest_seccode,addressIp:c,serverStatus:o}})).then(function(e){200!==e.status&&t.reset()}).catch(function(e){console.log(e),h.default.MsgTip({msg:"服务器繁忙"})}),n.nextHandle()}),t&&o.setState({captchaObj:t})},o.nextHandle=function(){var t=e("#tel").val().replace(/\s+/g,""),n=o.state,a=n.count,c=n.codeSend;if(!c){e(".get-code").addClass("countdown").removeClass("send-code"),o.setState({codeSend:!0}),o.timer=setInterval(function(){c=!0,0===--a&&(a=60,c=!1,clearInterval(this.timer),e(".get-code").addClass("send-code").removeClass("countdown")),this.setState({count:a,codeSend:c})}.bind(o),1e3);var r=o;y.default.request(u({},N.uc_sendCode,{data:{appId:_.UCAPPID,phone:t,usage:"QUICK_LOGIN_REGISTER"}})).then(function(e){var t=e.data;"200"===t.code?h.default.MsgTip({msg:"验证码已发送"}):h.default.MsgTip({msg:t.message})}).catch(function(){h.default.MsgTip({msg:"服务器繁忙"})}),y.default.request(u({},N.uc_phoneExist(t),{params:{appId:_.UCAPPID}})).then(function(e){var t=e.data;"200"===t.code&&r.setState({isNew:!t.body})}).catch(function(){h.default.MsgTip({msg:"服务器繁忙"})})}},o.getCode=function(){var t=e("#tel").val().replace(/\s+/g,"");o.checkTel(t)&&(o.loadCaptchas(t),o.getCatcha())},o.getCatcha=function(){var e=o.state.captchaObj;e?e.verify():setTimeout(o.getCatcha,1e3)},o.changeHandle=function(){var t=e("#tel").val().replace(/\s+/g,""),n=e("#code").val().replace(/\s+/g,"");11===t.length&&n?o.setState({inputComp:!0}):o.setState({inputComp:!1})},o.loginHandle=function(){var t=e("#tel").val().replace(/\s+/g,""),n=e("#code").val().replace(/\s+/g,"");if(o.checkTel(t)&&o.checkCode(n)){var a=o.state.isNew,c=o.props.params,r=c.redirect_uri,l=c.invite,i=c.from;"ecard_red_jr"===i&&a&&/^TRC_/gi.test(l)&&(l=""+parseInt(l.substring(4))/7);var s=o;y.default.request(u({},N.uc_loginOrReg,{headers:{"X-Platform-Info":"H5"},data:{appId:_.UCAPPID,phone:t,phoneCode:n}})).then(function(e){var t=e.data;"200"===t.code?(h.default.MsgTip({msg:"成功"}),(0,w.setCookie)("token",t.body.token),s.props.changeLogin(!0),r&&"ecard_red_jr"===i||!/\?/.test(r)?window.location.replace(r):/\?/.test(r)?window.location.replace(r+"&user="+(a?"new":"old")):g.browserHistory.goBack()):h.default.MsgTip({msg:t.message})}).catch(function(e){console.log(e),s.props.changeLogin(!1)})}},o.delHandle=function(t){e(t.target).prev().val("").focus(),o.setState({inputComp:!1})},o.onlyNum=function(){e("#tel").val(e("#tel").val().replace(/\D/g,"")),e("#code").val(e("#code").val().replace(/\D/g,""))},o.state={count:60,codeSend:!1,telCorrect:!1,inputComp:!1,isNew:!1},o}return k(n,p.Component),d(n,[{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"render",value:function(){var t=this.state,n=t.count,a=t.codeSend,o=t.inputComp,c=t.telCorrect,r=a?n+"s后重发":"获取验证码",l=e("#tel").val();return f.default.createElement("div",{className:"input-area"},f.default.createElement("div",{className:"input-info c-pr"},f.default.createElement("input",{type:"text",id:"tel",placeholder:"泰然城账号/手机号码",maxLength:"11",onChange:this.changeHandle,onKeyUp:this.onlyNum,onPaste:this.onlyNum}),f.default.createElement("img",{className:"del-icon "+(l?"":"c-dpno"),src:"/src/img/user/delete.png",onClick:this.delHandle})),f.default.createElement("div",{className:"input-info c-pr"},f.default.createElement("input",{type:"text",id:"code",placeholder:"请输入验证码",maxLength:"4",onChange:this.changeHandle,onKeyUp:this.onlyNum,onPaste:this.onlyNum}),f.default.createElement("span",{className:"get-code c-tc send-code",onClick:this.getCode,disabled:!(c&&a)},r)),f.default.createElement("input",{type:"button",className:"submit-btn c-tc",style:{background:o?"#353535":"#c9c9c9"},disabled:!o,value:"登录",onClick:this.loginHandle}))}}]),n}(),L=function(t){function n(t){E(this,n);var o=b(this,(n.__proto__||(0,a.default)(n)).call(this,t));return o.pwdToggle=function(){o.setState({showPwd:!o.state.showPwd})},o.checkTel=function(e){return/^1[34578]\d{9}$/.test(e.trim())?(o.setState({telCorrect:!0}),!0):(h.default.MsgTip({msg:"请输入正确的手机号码"}),!1)},o.checkPwd=function(e){return!0},o.changeHandle=function(){var t=e("#tel").val().replace(/\s+/g,""),n=e("#pwd").val().replace(/\s+/g,"");t?o.setState({tel:t}):o.setState({tel:""}),11===t.length&&n.length>=6?o.setState({inputComp:!0}):o.setState({inputComp:!1})},o.loginHandle=function(){var t=e("#tel").val().replace(/\s+/g,""),n=e("#pwd").val().replace(/\s+/g,"");if(o.checkTel(t)&&o.checkPwd(n)){var a=o.props.redirect_uri,c=o;y.default.request(u({},N.uc_loginByPwd,{data:{appId:_.UCAPPID,encryptFlag:!1,password:n,phone:t}})).then(function(e){var t=e.data;"200"===t.code?(h.default.MsgTip({msg:"登录成功"}),(0,w.setCookie)("token",t.body.token),c.props.changeLogin(!0),a?window.location.replace(a):window.history.go(-1)):h.default.MsgTip({msg:t.message})}).catch(function(e){var t=e.error;console.log(t),h.default.MsgTip({msg:"服务器繁忙"}),c.props.changeLogin(!1)})}},o.delHandle=function(t){e(t.target).prev().val("").focus(),o.setState({inputComp:!1})},o.onlyNum=function(){e("#tel").val(e("#tel").val().replace(/\D/g,""))},o.state={tel:"",showPwd:!1,inputComp:!1},o}return k(n,p.Component),d(n,[{key:"render",value:function(){var e=this.state,t=e.tel,n=e.showPwd,a=e.inputComp;return f.default.createElement("div",{className:"input-area"},f.default.createElement("div",{className:"input-info c-pr"},f.default.createElement("input",{type:"text",id:"tel",placeholder:"请输入手机号码/泰然城账号",maxLength:"11",onChange:this.changeHandle,onKeyUp:this.onlyNum,onPaste:this.onlyNum}),f.default.createElement("img",{className:"del-icon "+(t?"":"c-dpno"),src:"/src/img/user/delete.png",onClick:this.delHandle})),f.default.createElement("div",{className:"input-info c-pr"},f.default.createElement("input",{type:n?"text":"password",id:"pwd",placeholder:"请输入密码",maxLength:"20",onChange:this.changeHandle}),n?f.default.createElement("img",{className:"eye-open",src:"/src/img/user/eye-open.png",onClick:this.pwdToggle}):f.default.createElement("img",{className:"eye-close",src:"/src/img/user/eye-close.png",onClick:this.pwdToggle})),f.default.createElement("input",{type:"button",className:"submit-btn c-tc",style:{background:a?"#353535":"#c9c9c9"},disabled:!a,value:"登录",onClick:this.loginHandle}),f.default.createElement(g.Link,{to:_.DIR+"/forgetPwd"},f.default.createElement("div",{className:"forget-btn"},"忘记密码")))}}]),n}();function x(e,t){return u({},e.wapLoginIndex)}function P(e,t){return{changeLogin:function(t){e(T("changeLogin",{login:t}))}}}t.default=(0,v.connect)(x,P)(S)}).call(this,n("OOjC"))},"4I33":function(e,t,n){var a;!function(o,c){"use strict";void 0===(a=function(){return function(e,t){if(void 0===e)throw new Error("Geetest requires browser environment");var n=e.document,a=e.Math,o=n.getElementsByTagName("head")[0];function c(e){this._obj=e}function r(e){var t=this;new c(e)._each(function(e,n){t[e]=n})}c.prototype={_each:function(e){var t=this._obj;for(var n in t)t.hasOwnProperty(n)&&e(n,t[n]);return this}},r.prototype={api_server:"api.geetest.com",protocol:"http://",type_path:"/gettype.php",fallback_config:{slide:{static_servers:["static.geetest.com","dn-staticdown.qbox.me"],type:"slide",slide:"/static/js/geetest.0.0.0.js"},fullpage:{static_servers:["static.geetest.com","dn-staticdown.qbox.me"],type:"fullpage",fullpage:"/static/js/fullpage.0.0.0.js"}},_get_fallback_config:function(){return l(this.type)?this.fallback_config[this.type]:this.new_captcha?this.fallback_config.fullpage:this.fallback_config.slide},_extend:function(e){var t=this;new c(e)._each(function(e,n){t[e]=n})}};var l=function(e){return"string"==typeof e},i={},s={},u=function(e,t,n,a){t=function(e){return e.replace(/^https?:\/\/|\/$/g,"")}(t);var o=function(e){0!==(e=e.replace(/\/+/g,"/")).indexOf("/")&&(e="/"+e);return e}(n)+function(e){if(!e)return"";var t="?";new c(e)._each(function(e,n){(l(n)||function(e){return"number"==typeof e}(n)||function(e){return"boolean"==typeof e}(n))&&(t=t+encodeURIComponent(e)+"="+encodeURIComponent(n)+"&")}),"?"===t&&(t="");return t.replace(/&$/,"")}(a);return t&&(o=e+t+o),o},d=function(e,t,a,c,r){var l=function(i){var s=u(e,t[i],a,c);!function(e,t){var a=n.createElement("script");a.charset="UTF-8",a.async=!0,a.onerror=function(){t(!0)};var c=!1;a.onload=a.onreadystatechange=function(){c||a.readyState&&"loaded"!==a.readyState&&"complete"!==a.readyState||(c=!0,setTimeout(function(){t(!1)},0))},a.src=e,o.appendChild(a)}(s,function(e){e?i>=t.length-1?r(!0):l(i+1):r(!1)})};l(0)},p=function(t,n,o,c){if("object"==typeof(r=o.getLib)&&null!==r)return o._extend(o.getLib),void c(o);var r;if(o.offline)c(o._get_fallback_config());else{var l="geetest_"+(parseInt(1e4*a.random())+(new Date).valueOf());e[l]=function(t){"success"===t.status?c(t.data):t.status?c(o._get_fallback_config()):c(t),e[l]=void 0;try{delete e[l]}catch(e){}},d(o.protocol,t,n,{gt:o.gt,callback:l},function(e){e&&c(o._get_fallback_config())})}},f=function(e,t){var n={networkError:"网络错误"};if("function"!=typeof t.onError)throw new Error(n[e]);t.onError(n[e])};e.Geetest&&(s.slide="loaded");var g=function(t,n){var a=new r(t);t.https?a.protocol="https://":t.protocol||(a.protocol=e.location.protocol+"//"),p([a.api_server||a.apiserver],a.type_path,a,function(t){var o=t.type,c=function(){a._extend(t),n(new e.Geetest(a))};i[o]=i[o]||[];var r=s[o]||"init";"init"===r?(s[o]="loading",i[o].push(c),d(a.protocol,t.static_servers||t.domains,t[o]||t.path,null,function(e){if(e)s[o]="fail",f("networkError",a);else{s[o]="loaded";for(var t=i[o],n=0,c=t.length;n<c;n+=1){var r=t[n];"function"==typeof r&&r()}i[o]=[]}})):"loaded"===r?c():"fail"===r?f("networkError",a):"loading"===r&&i[o].push(c)})};return e.initGeetest=g,g}(o)}.call(t,n,t,e))||(e.exports=a)}("undefined"!=typeof window?window:this)},cQc5:function(e,t,n){}}]);